<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIè£å‰ªæ•ˆæœéªŒè¯ - ç®€åŒ–ç‰ˆ</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, sans-serif; 
            max-width: 900px; 
            margin: 0 auto; 
            padding: 20px; 
            background: #f5f7fa; 
        }
        .test-case { 
            background: white; 
            margin: 25px 0; 
            padding: 25px; 
            border-radius: 15px; 
            box-shadow: 0 5px 20px rgba(0,0,0,0.1); 
        }
        .test-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 20px; 
        }
        .test-title { color: #2c3e50; font-size: 1.2em; margin: 0; }
        .test-status { 
            padding: 6px 12px; 
            border-radius: 20px; 
            font-size: 0.85em; 
            font-weight: 600;
            background: #ffeaa7; 
            color: #d63031; 
        }
        .test-button { 
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }
        .test-button:hover { transform: translateY(-2px); }
        .test-button:disabled { opacity: 0.6; cursor: not-allowed; }
        .result-area { 
            background: #f8f9fa; 
            padding: 15px; 
            border-radius: 10px; 
            margin-top: 15px;
            display: none;
        }
        .success { background: #d1edff; border-left: 4px solid #007bff; }
        .error { background: #ffe6e6; border-left: 4px solid #dc3545; }
        .log { 
            background: #2c3e50; 
            color: #ecf0f1; 
            padding: 15px; 
            border-radius: 8px; 
            font-family: 'Courier New', monospace; 
            font-size: 0.9em;
            margin-top: 15px;
            white-space: pre-line;
        }
        h1 { text-align: center; color: #2c3e50; }
        .summary { text-align: center; color: #7f8c8d; margin-bottom: 40px; }
    </style>
</head>
<body>
    <h1>ğŸ¤– AIè£å‰ªæ•ˆæœéªŒè¯æµ‹è¯•</h1>
    <p class="summary">æ¨¡æ‹ŸGPT-4.1 Vision APIçš„5ä¸ªä¸åŒåœºæ™¯æ™ºèƒ½è£å‰ªæµ‹è¯•</p>

    <!-- æµ‹è¯•æ¡ˆä¾‹1: Instagramå¸–å­ -->
    <div class="test-case">
        <div class="test-header">
            <h3 class="test-title">ğŸ“¸ æµ‹è¯•1: äººåƒæ‘„å½± â†’ Instagramå¸–å­ (1:1)</h3>
            <span class="test-status" id="status1">å¾…æµ‹è¯•</span>
        </div>
        <p><strong>åœºæ™¯æè¿°:</strong> 1200Ã—800çš„äººåƒç…§ç‰‡ï¼Œéœ€è¦è£å‰ªä¸º1080Ã—1080çš„Instagramå¸–å­æ ¼å¼</p>
        <button class="test-button" onclick="runTest(1, 'instagram-post', 'äººåƒæ‘„å½±')" id="btn1">å¼€å§‹æµ‹è¯•</button>
        <div class="result-area" id="result1"></div>
        <div class="log" id="log1" style="display: none;"></div>
    </div>

    <!-- æµ‹è¯•æ¡ˆä¾‹2: Instagramæ•…äº‹ -->
    <div class="test-case">
        <div class="test-header">
            <h3 class="test-title">ğŸï¸ æµ‹è¯•2: é£æ™¯ç…§ç‰‡ â†’ Instagramæ•…äº‹ (9:16)</h3>
            <span class="test-status" id="status2">å¾…æµ‹è¯•</span>
        </div>
        <p><strong>åœºæ™¯æè¿°:</strong> 1600Ã—900çš„é£æ™¯ç…§ç‰‡ï¼Œéœ€è¦è£å‰ªä¸º1080Ã—1920çš„Instagramæ•…äº‹æ ¼å¼</p>
        <button class="test-button" onclick="runTest(2, 'instagram-story', 'é£æ™¯æ‘„å½±')" id="btn2">å¼€å§‹æµ‹è¯•</button>
        <div class="result-area" id="result2"></div>
        <div class="log" id="log2" style="display: none;"></div>
    </div>

    <!-- æµ‹è¯•æ¡ˆä¾‹3: TikTok -->
    <div class="test-case">
        <div class="test-header">
            <h3 class="test-title">ğŸ‘¥ æµ‹è¯•3: å¤šäººåˆå½± â†’ TikTok (9:16)</h3>
            <span class="test-status" id="status3">å¾…æµ‹è¯•</span>
        </div>
        <p><strong>åœºæ™¯æè¿°:</strong> 1400Ã—1000çš„ç¾¤ä½“ç…§ç‰‡ï¼Œéœ€è¦è£å‰ªä¸º1080Ã—1920çš„TikTokæ ¼å¼</p>
        <button class="test-button" onclick="runTest(3, 'tiktok', 'å¤šäººåˆå½±')" id="btn3">å¼€å§‹æµ‹è¯•</button>
        <div class="result-area" id="result3"></div>
        <div class="log" id="log3" style="display: none;"></div>
    </div>

    <!-- æµ‹è¯•æ¡ˆä¾‹4: LinkedInå¤´åƒ -->
    <div class="test-case">
        <div class="test-header">
            <h3 class="test-title">ğŸ’¼ æµ‹è¯•4: å•†åŠ¡å¤´åƒ â†’ LinkedInå¤´åƒ (1:1)</h3>
            <span class="test-status" id="status4">å¾…æµ‹è¯•</span>
        </div>
        <p><strong>åœºæ™¯æè¿°:</strong> 1000Ã—1200çš„å•†åŠ¡ç…§ç‰‡ï¼Œéœ€è¦è£å‰ªä¸º400Ã—400çš„LinkedInå¤´åƒæ ¼å¼</p>
        <button class="test-button" onclick="runTest(4, 'linkedin-avatar', 'å•†åŠ¡å¤´åƒ')" id="btn4">å¼€å§‹æµ‹è¯•</button>
        <div class="result-area" id="result4"></div>
        <div class="log" id="log4" style="display: none;"></div>
    </div>

    <!-- æµ‹è¯•æ¡ˆä¾‹5: å¾®ä¿¡å¤´åƒ -->
    <div class="test-case">
        <div class="test-header">
            <h3 class="test-title">ğŸ˜Š æµ‹è¯•5: ç”Ÿæ´»ç…§ç‰‡ â†’ å¾®ä¿¡å¤´åƒ (1:1)</h3>
            <span class="test-status" id="status5">å¾…æµ‹è¯•</span>
        </div>
        <p><strong>åœºæ™¯æè¿°:</strong> 1100Ã—800çš„ç”Ÿæ´»ç…§ç‰‡ï¼Œéœ€è¦è£å‰ªä¸º640Ã—640çš„å¾®ä¿¡å¤´åƒæ ¼å¼</p>
        <button class="test-button" onclick="runTest(5, 'wechat-avatar', 'ä¼‘é—²ç”Ÿæ´»')" id="btn5">å¼€å§‹æµ‹è¯•</button>
        <div class="result-area" id="result5"></div>
        <div class="log" id="log5" style="display: none;"></div>
    </div>

    <!-- æ‰¹é‡æµ‹è¯• -->
    <div style="text-align: center; margin: 40px 0;">
        <button class="test-button" onclick="runAllTests()" style="font-size: 1.1em; padding: 15px 30px;">
            ğŸš€ è¿è¡Œæ‰€æœ‰æµ‹è¯•
        </button>
        <button class="test-button" onclick="showLogs()" style="background: #6c757d;">
            ğŸ“‹ æ˜¾ç¤ºè¯¦ç»†æ—¥å¿—
        </button>
    </div>

    <script>
        // æ¨¡æ‹ŸGPT-4.1 Vision APIçš„å“åº”
        const mockGPTResponses = {
            'instagram-post': {
                reason: "æ£€æµ‹åˆ°äººåƒä¸»ä½“ä½äºç”»é¢ä¸­å¤®åä¸Šä½ç½®ã€‚åº”ç”¨ä¸‰åˆ†æ³•åˆ™ï¼Œå°†äººç‰©å¤´éƒ¨æ”¾ç½®åœ¨ä¸Šæ–¹ä¸‰åˆ†çº¿é™„è¿‘ï¼Œç¡®ä¿é¢éƒ¨å®Œæ•´æ€§å’Œè§†è§‰å¹³è¡¡ã€‚",
                details: "äººè„¸æ£€æµ‹ç½®ä¿¡åº¦: 95.2%ã€‚å»ºè®®è£å‰ªåŒºåŸŸé¿å¼€ç”»é¢è¾¹ç¼˜25%åŒºåŸŸã€‚é‡‡ç”¨ä¸­å¿ƒæ„å›¾ï¼Œä¿æŒ1:1æ¯”ä¾‹çš„è§†è§‰å’Œè°ã€‚",
                crop_params: {
                    original_size: [1200, 800],
                    crop_box: { x: 225, y: 0, width: 750, height: 750 },
                    output_size: [1080, 1080],
                    crop_ratio: "1:1"
                }
            },
            'instagram-story': {
                reason: "é£æ™¯ç…§ç‰‡çš„ä¸»è¦å…ƒç´ ï¼ˆå±±å³°ã€å¤©ç©ºï¼‰ä½äºä¸Šæ–¹ã€‚ä¸ºé€‚åº”ç«–å±æ ¼å¼ï¼Œé‡ç‚¹ä¿ç•™å¤©ç©ºå’Œå±±è„‰çš„å®Œæ•´è½®å»“ï¼ŒåŒæ—¶åŒ…å«éƒ¨åˆ†å‰æ™¯è‰åœ°ä»¥å¢åŠ å±‚æ¬¡æ„Ÿã€‚",
                details: "å¤©ç©ºå æ¯”è°ƒæ•´è‡³40%ï¼Œå±±è„‰è½®å»“å®Œæ•´ä¿ç•™ã€‚å‰æ™¯è‰åœ°ä½œä¸ºè§†è§‰é”šç‚¹ã€‚è‰²å½©å¹³è¡¡è‰¯å¥½ï¼Œæ— éœ€ç‰¹æ®Šè°ƒæ•´ã€‚",
                crop_params: {
                    original_size: [1600, 900],
                    crop_box: { x: 300, y: 0, width: 1000, height: 1778 },
                    output_size: [1080, 1920],
                    crop_ratio: "9:16"
                }
            },
            'tiktok': {
                reason: "å¤šäººåˆå½±éœ€è¦ç¡®ä¿æ‰€æœ‰ä¸»è¦äººç‰©éƒ½åŒ…å«åœ¨è£å‰ªåŒºåŸŸå†…ã€‚æ£€æµ‹åˆ°4ä¸ªäººç‰©ä¸»ä½“ï¼Œé‡‡ç”¨ç¾¤ä½“æ„å›¾åŸåˆ™ï¼Œä¿æŒäººç‰©é—´çš„ç›¸å¯¹ä½ç½®å…³ç³»ã€‚",
                details: "äººç‰©æ£€æµ‹æ•°é‡: 4ä¸ªã€‚ç¾¤ä½“é‡å¿ƒä½äºç”»é¢ä¸­å¤®åå·¦ã€‚è£å‰ªæ—¶ä¿ç•™10%çš„è¾¹ç¼˜ç©ºé—´é¿å…äººç‰©è¢«æˆªæ–­ã€‚",
                crop_params: {
                    original_size: [1400, 1000],
                    crop_box: { x: 262, y: 0, width: 875, height: 1556 },
                    output_size: [1080, 1920],
                    crop_ratio: "9:16"
                }
            },
            'linkedin-avatar': {
                reason: "ä¸“ä¸šå•†åŠ¡å¤´åƒéœ€è¦çªå‡ºé¢éƒ¨ç‰¹å¾å’ŒèŒä¸šå½¢è±¡ã€‚é‡‡ç”¨ç»å…¸å¤´åƒæ„å›¾ï¼Œäººç‰©å±…ä¸­ï¼Œä¿ç•™é€‚å½“çš„è‚©éƒ¨ç©ºé—´ä»¥æ˜¾ç¤ºæ­£å¼ç€è£…ã€‚",
                details: "é¢éƒ¨ç‰¹å¾æ¸…æ™°åº¦: ä¼˜ç§€ã€‚èŒä¸šç€è£…è¯†åˆ«: æ­£è£…å¥—è£…ã€‚å»ºè®®ä¿ç•™å¤´éƒ¨åˆ°èƒ¸éƒ¨çš„æ ‡å‡†å•†åŠ¡å¤´åƒæ¯”ä¾‹ã€‚èƒŒæ™¯ç®€æ´åº¦è‰¯å¥½ã€‚",
                crop_params: {
                    original_size: [1000, 1200],
                    crop_box: { x: 200, y: 150, width: 600, height: 600 },
                    output_size: [400, 400],
                    crop_ratio: "1:1"
                }
            },
            'wechat-avatar': {
                reason: "ç”Ÿæ´»ç…§ç‰‡é£æ ¼è½»æ¾è‡ªç„¶ï¼Œé€‚åˆä¸ªäººç¤¾äº¤ä½¿ç”¨ã€‚ä¿æŒäººç‰©çš„äº²å’ŒåŠ›è¡¨è¾¾ï¼ŒåŒæ—¶åŒ…å«éƒ¨åˆ†èƒŒæ™¯è£…é¥°å…ƒç´ ä»¥å¢åŠ è¶£å‘³æ€§ã€‚",
                details: "è¡¨æƒ…è‡ªç„¶åº¦: å¾ˆå¥½ã€‚èƒŒæ™¯è£…é¥°å…ƒç´ ï¼ˆèŠ±æœµï¼‰å¢åŠ è§†è§‰è¶£å‘³ã€‚è‰²å½©æ¸©æš–ï¼Œç¬¦åˆä¸ªäººå¤´åƒçš„å‹å¥½åŸºè°ƒã€‚",
                crop_params: {
                    original_size: [1100, 800],
                    crop_box: { x: 250, y: 100, width: 600, height: 600 },
                    output_size: [640, 640],
                    crop_ratio: "1:1"
                }
            }
        };

        let testResults = {};
        let allLogs = '';

        // æ—¥å¿—å‡½æ•°
        function log(testId, message) {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            allLogs += logMessage + '\n';
            
            const logArea = document.getElementById(`log${testId}`);
            if (logArea) {
                logArea.textContent += logMessage + '\n';
            }
            console.log(`Test ${testId}: ${message}`);
        }

        // æ›´æ–°çŠ¶æ€
        function updateStatus(testId, text, success = null) {
            const statusEl = document.getElementById(`status${testId}`);
            statusEl.textContent = text;
            if (success === true) {
                statusEl.style.background = '#d4edda';
                statusEl.style.color = '#155724';
            } else if (success === false) {
                statusEl.style.background = '#f8d7da';
                statusEl.style.color = '#721c24';
            }
        }

        // æ¨¡æ‹ŸGPT APIè°ƒç”¨
        async function mockGPTAPICall(scene, imageType) {
            // æ¨¡æ‹ŸAPIå»¶è¿Ÿ
            await new Promise(resolve => setTimeout(resolve, 1500 + Math.random() * 1000));
            
            if (Math.random() < 0.1) {
                // 10%æ¦‚ç‡æ¨¡æ‹ŸAPIé”™è¯¯
                throw new Error('GPT APIè°ƒç”¨å¤±è´¥: ç½‘ç»œè¶…æ—¶');
            }
            
            return mockGPTResponses[scene];
        }

        // éªŒè¯è£å‰ªå‚æ•°
        function validateCropParams(cropParams, scene) {
            const { original_size, crop_box, output_size, crop_ratio } = cropParams;
            
            // æ£€æŸ¥è£å‰ªæ¡†æ˜¯å¦åœ¨åŸå›¾èŒƒå›´å†…
            if (crop_box.x < 0 || crop_box.y < 0 || 
                crop_box.x + crop_box.width > original_size[0] ||
                crop_box.y + crop_box.height > original_size[1]) {
                return { valid: false, error: 'è£å‰ªæ¡†è¶…å‡ºåŸå›¾è¾¹ç•Œ' };
            }
            
            // æ£€æŸ¥è¾“å‡ºæ¯”ä¾‹
            const expectedRatio = crop_ratio === '1:1' ? 1 : crop_ratio === '9:16' ? 9/16 : 1;
            const actualRatio = output_size[0] / output_size[1];
            
            if (Math.abs(actualRatio - expectedRatio) > 0.01) {
                return { valid: false, error: 'è¾“å‡ºæ¯”ä¾‹ä¸æ­£ç¡®' };
            }
            
            return { valid: true, message: 'å‚æ•°éªŒè¯é€šè¿‡' };
        }

        // è¿è¡Œå•ä¸ªæµ‹è¯•
        async function runTest(testId, scene, imageType) {
            try {
                updateStatus(testId, 'æµ‹è¯•ä¸­...');
                document.getElementById(`btn${testId}`).disabled = true;
                document.getElementById(`log${testId}`).style.display = 'block';
                
                log(testId, `ğŸš€ å¼€å§‹æµ‹è¯•: ${imageType} â†’ ${scene}`);
                
                // 1. æ¨¡æ‹ŸGPT-4.1åˆ†æ
                log(testId, 'ğŸ¤– è°ƒç”¨GPT-4.1 Vision APIåˆ†æ...');
                const cropSolution = await mockGPTAPICall(scene, imageType);
                
                // 2. éªŒè¯è£å‰ªå‚æ•°
                log(testId, 'âœ‚ï¸ éªŒè¯è£å‰ªå‚æ•°...');
                const validation = validateCropParams(cropSolution.crop_params, scene);
                
                if (!validation.valid) {
                    throw new Error(`å‚æ•°éªŒè¯å¤±è´¥: ${validation.error}`);
                }
                
                // 3. æ˜¾ç¤ºç»“æœ
                const resultArea = document.getElementById(`result${testId}`);
                resultArea.style.display = 'block';
                resultArea.className = 'result-area success';
                resultArea.innerHTML = `
                    <h4>ğŸ‰ æµ‹è¯•æˆåŠŸ!</h4>
                    <p><strong>ğŸ¤– AIåˆ†æ:</strong> ${cropSolution.reason}</p>
                    <p><strong>ğŸ“Š æŠ€æœ¯ç»†èŠ‚:</strong> ${cropSolution.details}</p>
                    <p><strong>ğŸ“ è£å‰ªå‚æ•°:</strong></p>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>åŸå§‹å°ºå¯¸: ${cropSolution.crop_params.original_size[0]}Ã—${cropSolution.crop_params.original_size[1]}</li>
                        <li>è£å‰ªåŒºåŸŸ: (${cropSolution.crop_params.crop_box.x}, ${cropSolution.crop_params.crop_box.y}) 
                            ${cropSolution.crop_params.crop_box.width}Ã—${cropSolution.crop_params.crop_box.height}</li>
                        <li>è¾“å‡ºå°ºå¯¸: ${cropSolution.crop_params.output_size[0]}Ã—${cropSolution.crop_params.output_size[1]}</li>
                        <li>ç›®æ ‡æ¯”ä¾‹: ${cropSolution.crop_params.crop_ratio}</li>
                    </ul>
                    <p><strong>âœ… æ ¼å¼éªŒè¯:</strong> ${validation.message}</p>
                `;
                
                testResults[testId] = {
                    success: true,
                    scene: scene,
                    imageType: imageType,
                    result: cropSolution
                };
                
                log(testId, `âœ… æµ‹è¯•å®Œæˆ! æ ¼å¼éªŒè¯é€šè¿‡`);
                updateStatus(testId, 'æµ‹è¯•æˆåŠŸ', true);
                
            } catch (error) {
                const resultArea = document.getElementById(`result${testId}`);
                resultArea.style.display = 'block';
                resultArea.className = 'result-area error';
                resultArea.innerHTML = `
                    <h4>âŒ æµ‹è¯•å¤±è´¥</h4>
                    <p><strong>é”™è¯¯ä¿¡æ¯:</strong> ${error.message}</p>
                `;
                
                testResults[testId] = {
                    success: false,
                    scene: scene,
                    imageType: imageType,
                    error: error.message
                };
                
                log(testId, `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`);
                updateStatus(testId, 'æµ‹è¯•å¤±è´¥', false);
                
            } finally {
                document.getElementById(`btn${testId}`).disabled = false;
            }
        }

        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        async function runAllTests() {
            console.log('ğŸš€ å¼€å§‹è¿è¡Œæ‰€æœ‰AIè£å‰ªæµ‹è¯•...');
            
            const tests = [
                {id: 1, scene: 'instagram-post', type: 'äººåƒæ‘„å½±'},
                {id: 2, scene: 'instagram-story', type: 'é£æ™¯æ‘„å½±'},
                {id: 3, scene: 'tiktok', type: 'å¤šäººåˆå½±'},
                {id: 4, scene: 'linkedin-avatar', type: 'å•†åŠ¡å¤´åƒ'},
                {id: 5, scene: 'wechat-avatar', type: 'ä¼‘é—²ç”Ÿæ´»'}
            ];
            
            for (const test of tests) {
                await runTest(test.id, test.scene, test.type);
                await new Promise(resolve => setTimeout(resolve, 500)); // 500msé—´éš”
            }
            
            // æ˜¾ç¤ºæµ‹è¯•æ€»ç»“
            const successCount = Object.values(testResults).filter(r => r.success).length;
            console.log(`ğŸ‰ æµ‹è¯•å®Œæˆ! æˆåŠŸ: ${successCount}/5`);
            
            alert(`ğŸ‰ æ‰€æœ‰æµ‹è¯•å®Œæˆ!\næˆåŠŸ: ${successCount}/5\nå¤±è´¥: ${5-successCount}/5`);
        }

        // æ˜¾ç¤ºè¯¦ç»†æ—¥å¿—
        function showLogs() {
            const logWindow = window.open('', '_blank', 'width=800,height=600');
            logWindow.document.write(`
                <html>
                <head><title>AIè£å‰ªæµ‹è¯• - è¯¦ç»†æ—¥å¿—</title></head>
                <body style="font-family: monospace; background: #2c3e50; color: #ecf0f1; padding: 20px;">
                <h2 style="color: #3498db;">ğŸ¤– AIè£å‰ªæµ‹è¯•è¯¦ç»†æ—¥å¿—</h2>
                <pre>${allLogs}</pre>
                </body>
                </html>
            `);
        }

        console.log('ğŸ¨ AIè£å‰ªæ•ˆæœéªŒè¯æµ‹è¯•é¡µé¢å·²åŠ è½½');
        console.log('ğŸ“‹ æ”¯æŒçš„æµ‹è¯•åœºæ™¯:');
        console.log('1. äººåƒæ‘„å½± â†’ Instagramå¸–å­ (1:1)');
        console.log('2. é£æ™¯æ‘„å½± â†’ Instagramæ•…äº‹ (9:16)');
        console.log('3. å¤šäººåˆå½± â†’ TikTok (9:16)');
        console.log('4. å•†åŠ¡å¤´åƒ â†’ LinkedInå¤´åƒ (1:1)');
        console.log('5. ä¼‘é—²ç”Ÿæ´» â†’ å¾®ä¿¡å¤´åƒ (1:1)');
    </script>
</body>
</html>